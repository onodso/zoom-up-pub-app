# gBizINFO データ手動ダウンロード & インポート手順

APIの接続制限（500エラー）を回避するため、公式サイトからCSVデータを一括ダウンロードして取り込む手順を案内します。

## 1. データのダウンロード (正式な手順)

**重要**: 「法人基本情報」は検索バーで検索するものではなく、専用のダウンロードページから取得するものです。

1.  Webブラウザで **[gBizINFOトップページ](https://info.gbiz.go.jp/)** にアクセスします。
2.  画面上部のメニュー、またはページ下部のフッターにある **「データダウンロード」** というリンクを探してクリックします。
    - ※以前の直リンクが404エラーになる場合は、必ずトップページから移動してください。
3.  移動先のページで **「一括ダウンロード」** セクションを探します。
4.  **「基本情報」** の「CSV」または「ZIP」ボタンをクリックします。
    - 推奨ファイル名: `hojin_kihon_utf8.zip` (UTF-8版)
    - サイズ: 数GBあります。Wi-Fi環境推奨。
5.  ダウンロードしたZIPファイルを、プロジェクトの以下のディレクトリに配置します。
    - パス: `zoom-up-pub-app/data/gbizinfo/`
    - ファイル名: `hojin_kihon.zip` (または任意の .zip)
    - **注意**: 解凍する必要はありません。スクリプトがZIPを直接読み込みます。

## 2. ディレクトリの作成

もし `data/gbizinfo` フォルダがない場合は作成してください。

```bash
mkdir -p data/gbizinfo
```

## 3. インポートスクリプトの実行

ZIPファイルを配置したら、以下のコマンドでインポートを実行します。
スクリプトは自動的に「北海道」の住所を持つデータのみを抽出し、DBに取り込みます。

```bash
# Dockerコンテナ内で実行
docker compose exec api python scripts/import_gbizinfo_csv.py
```

## 4. 処理内容
- ZIP内のCSVをストリーム読み込み（メモリ節約）
- `国内所在地` カラムが "北海道" で始まる行をフィルタリング
- `jageocoder` (またはMock) で座標変換
- メッシュコード計算
- `companies` テーブルと `meshes` テーブルに保存

## 補足
- 処理には数分〜数十分かかる場合があります（データ量に依存）。
- 万が一文字化けする場合は、スクリプト(`scripts/import_gbizinfo_csv.py`)内の `encoding='ms932'` (Shift-JIS) を `utf-8` に変更してみてください。
